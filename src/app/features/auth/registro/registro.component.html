<div class="auth-shell container">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-10">
      <div class="auth-card">
        <div class="auth-header">
          <p class="eyebrow">Alta de usuario</p>
          <h2>Crear cuenta</h2>
          <p class="subtitle">Registra pacientes, medicos o administradores con validaciones visibles.</p>
        </div>

        <form [formGroup]="form" (ngSubmit)="submit()" novalidate class="auth-form">
          <div class="row g-3">
            <div class="col-12 col-md-6">
              <label for="nombre">Nombre</label>
              <input id="nombre" class="form-control" formControlName="nombre" placeholder="Nombre" />
              <div class="text-danger" *ngIf="f['nombre'].touched && f['nombre'].invalid">Este campo es obligatorio.</div>
            </div>
            <div class="col-12 col-md-6">
              <label for="apellido">Apellido</label>
              <input id="apellido" class="form-control" formControlName="apellido" placeholder="Apellido" />
              <div class="text-danger" *ngIf="f['apellido'].touched && f['apellido'].invalid">Este campo es obligatorio.</div>
            </div>
            <div class="col-12 col-md-6">
              <label for="correo">Correo</label>
              <input id="correo" class="form-control" formControlName="correo" type="email" placeholder="usuario@labcontrol.cl" />
              <div class="text-danger" *ngIf="f['correo'].touched && f['correo'].invalid">
                <div *ngIf="f['correo'].errors?.['required']">Obligatorio.</div>
                <div *ngIf="f['correo'].errors?.['email']">Formato invalido.</div>
              </div>
            </div>
            <div class="col-12 col-md-6">
              <label for="telefono">Telefono</label>
              <input id="telefono" class="form-control" formControlName="telefono" placeholder="+56 9 1234 5678" />
            </div>
            <div class="col-12 col-md-4">
              <label for="rol">Rol</label>
              <select id="rol" class="form-select" formControlName="rol">
                <option value="PATIENT">Paciente</option>
                <option value="MEDICO">Medico</option>
                <option value="ADMIN">Administrador</option>
              </select>
            </div>
            <div class="col-12 col-md-8 password-box" formGroupName="passwords">
              <label for="password">Contrasena</label>
              <input id="password" class="form-control" formControlName="password" type="password" placeholder="Mayuscula, minuscula, numero, simbolo" />
              <div class="text-danger" *ngIf="p['password'].touched && p['password'].invalid">
                <div *ngIf="p['password'].errors?.['required']">Obligatorio.</div>
                <div *ngIf="p['password'].errors?.['minlength']">Minimo 8 caracteres.</div>
                <div *ngIf="p['password'].errors?.['pattern'] && !p['password'].errors?.['minlength']">
                  <div *ngIf="!hasUpper()">Agrega una mayuscula.</div>
                  <div *ngIf="!hasLower()">Agrega una minuscula.</div>
                  <div *ngIf="!hasNumber()">Agrega un numero.</div>
                  <div *ngIf="!hasSymbol()">Agrega un simbolo.</div>
                </div>
              </div>

              <label for="confirmPassword" class="mt-2">Confirmar</label>
              <input id="confirmPassword" class="form-control" formControlName="confirmPassword" type="password" placeholder="Repite la contrasena" />
              <div class="text-danger" *ngIf="(p['confirmPassword'].touched || form.get('passwords')?.touched) && form.get('passwords')?.errors?.['mismatch']">
                Las contrasenas no coinciden.
              </div>

              <div class="password-meter">
                <span [class.ok]="hasUpper()">Aa</span>
                <span [class.ok]="hasLower()">aa</span>
                <span [class.ok]="hasNumber()">1</span>
                <span [class.ok]="hasSymbol()">#</span>
                <span [class.ok]="p['password'].value?.length >= 8">8+</span>
              </div>
            </div>
          </div>

          <div class="d-flex gap-2 mt-3">
            <button class="btn btn-primary" type="submit" [disabled]="loading || form.invalid">Registrar</button>
            <a routerLink="/auth/login" class="btn btn-outline-secondary">Volver a iniciar sesion</a>
          </div>

          <div class="alert alert-success mt-3" *ngIf="successMsg">{{ successMsg }}</div>
          <div class="alert alert-danger mt-3" *ngIf="error">{{ error }}</div>
        </form>
      </div>
    </div>
  </div>
</div>
